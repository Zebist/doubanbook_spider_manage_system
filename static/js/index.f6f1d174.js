(function(){var e={49166:function(e){const t={apiBaseUrl:""};e.exports=t},62319:function(e,t,r){"use strict";var n=r(86609),o=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("el-container",[t("el-container",[t("el-header",{staticStyle:{height:"auto"}},[t("HeaderBox",{staticClass:"header-box"})],1),t("el-main",[t("TableBox",{staticClass:"table-box"})],1),t("el-footer")],1)],1)],1)},i=[],a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"top-nav",attrs:{height:"auto"}},[t("div",{staticClass:"nav-content"},[t("h1",{staticClass:"nav-title"},[e._v("爬虫管理系统")]),t("el-button",{attrs:{id:"sync_btn",type:"primary"},on:{click:e.startCrawling}},[e._v("开始爬取")])],1)])},s=[],l=r(10101),u=r.n(l),c={methods:{startCrawling(){this.$axios.post("api/spider_center/").then((e=>{(0,l.Message)({type:"success",message:e.data.message,duration:3e3})})).catch((e=>{console.error(e),(0,l.Message)({type:"error",message:"服务异常，请稍候再试！",duration:3e3})}))}}},d=c,h=r(63101),f=(0,h.Z)(d,a,s,!1,null,"4c5d183f",null),p=f.exports,g=function(){var e=this,t=e._self._c;return t("div",{staticClass:"table-box"},[t("vxe-toolbar",{scopedSlots:e._u([{key:"buttons",fn:function(){return[t("vxe-input",{attrs:{type:"search",placeholder:"全表搜索"},on:{keyup:e.searchEvent1},model:{value:e.formData.searchContent,callback:function(t){e.$set(e.formData,"searchContent",t)},expression:"formData.searchContent"}})]},proxy:!0}])}),t("vxe-grid",e._b({ref:"xGrid",staticStyle:{height:"67vh"},attrs:{"row-config":e.rowConfig,"pager-config":e.gridOptions.pagerConfig},on:{"sort-change":e.handleSortChange,"page-change":e.handlePageChange,"edit-closed":e.handleEditClose,"edit-actived":e.handleEditActive},scopedSlots:e._u([{key:"operate",fn:function({row:r}){return[e.$refs.xGrid.isActiveByRow(r)?[t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.saveRowEvent(r)}}},[e._v("保存")])]:[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.editRowEvent(r)}}},[e._v("编辑")])],t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.removeRowEvent(r)}}},[e._v("删除/取消")])]}},{key:"cover_path_default",fn:function({row:e}){return[t("a",{staticClass:"my-link",attrs:{href:e.book_url,target:"_blank"}},[t("img",{staticClass:"cover_img",attrs:{src:e.cover_path}})])]}},{key:"cover_path_edit",fn:function(){return[t("vxe-input",{attrs:{id:"cover_path_input",type:"file"},on:{change:function(t){return e.handleFileChange(t)}}})]},proxy:!0},{key:"title_default",fn:function({row:r}){return[t("a",{staticClass:"my-link",attrs:{href:r.book_url,target:"_blank"}},[e._v(" "+e._s(r.title)+" ")])]}},{key:"title_edit",fn:function({row:r}){return[t("vxe-input",{attrs:{type:"text"},model:{value:r.title,callback:function(t){e.$set(r,"title",t)},expression:"row.title"}})]}},{key:"douban_id_edit",fn:function({row:r}){return[t("vxe-input",{attrs:{type:"text"},model:{value:r.douban_id,callback:function(t){e.$set(r,"douban_id",t)},expression:"row.douban_id"}})]}},{key:"title_2_edit",fn:function({row:r}){return[t("vxe-input",{attrs:{type:"text"},model:{value:r.title_2,callback:function(t){e.$set(r,"title_2",t)},expression:"row.title_2"}})]}},{key:"author_edit",fn:function({row:r}){return[t("vxe-input",{attrs:{type:"text"},model:{value:r.author,callback:function(t){e.$set(r,"author",t)},expression:"row.author"}})]}},{key:"publisher_edit",fn:function({row:r}){return[t("vxe-input",{attrs:{type:"text"},model:{value:r.publisher,callback:function(t){e.$set(r,"publisher",t)},expression:"row.publisher"}})]}},{key:"publish_date_edit",fn:function({row:r}){return[t("vxe-input",{attrs:{type:"text"},model:{value:r.publish_date,callback:function(t){e.$set(r,"publish_date",t)},expression:"row.publish_date"}})]}},{key:"price_edit",fn:function({row:r}){return[t("vxe-input",{attrs:{type:"number"},model:{value:r.price,callback:function(t){e.$set(r,"price",t)},expression:"row.price"}})]}},{key:"rating_edit",fn:function({row:r}){return[t("vxe-input",{attrs:{type:"number",min:"1",max:"10"},model:{value:r.rating,callback:function(t){e.$set(r,"rating",t)},expression:"row.rating"}})]}},{key:"review_count_edit",fn:function({row:r}){return[t("vxe-input",{attrs:{type:"number"},model:{value:r.review_count,callback:function(t){e.$set(r,"review_count",t)},expression:"row.review_count"}})]}},{key:"summary_edit",fn:function({row:r}){return[t("vxe-input",{attrs:{type:"text"},model:{value:r.summary,callback:function(t){e.$set(r,"summary",t)},expression:"row.summary"}})]}}])},"vxe-grid",e.gridOptions,!1))],1)},m=[],v=(r(52474),r(15397)),_=r.n(v),b={data(){return{default_timezone:"Asia/Shanghai",formData:{searchContent:""},coverPathImage:null,refreshDataTimer:null,refreshIntervalTime:1e4,seqColumn:[],sortInfo:[],pageInfo:null,rowConfig:{height:100},gridOptions:{border:!0,resizable:!0,align:"left",loading:!1,keepSource:!0,showOverflow:!0,columns:[{title:"操作",width:230,slots:{default:"operate"}}],sortConfig:{trigger:"cell",remote:!0},pagerConfig:{defaultPage:1,pageSize:10,pageSizes:[10,20,50,100,200],maxPageSize:10},editConfig:{trigger:"manual",mode:"row",showStatus:!0,icon:"vxe-icon-question-circle-fill"},toolbarConfig:{buttons:[{code:"insert_actived",name:"新增",icon:"vxe-icon-square-plus"}],zoom:!0,custom:!0},proxyConfig:{sort:!0,props:{result:"data.results",total:"data.count"},ajax:{query:({page:e,sorts:t})=>this.fetchData(e,t)}}}}},created(){this.refreshField()},mounted(){const e=this.$refs.xGrid;this.startRefreshInterval(e)},methods:{getCellRender(e){let t={cover_path:{default:"cover_path_default",edit:"cover_path_edit"},douban_id:{edit:"douban_id_edit"},title:{default:"title_default",edit:"title_edit"},title_2:{edit:"title_2_edit"},author:{edit:"author_edit"},publisher:{edit:"publisher_edit"},publish_date:{edit:"publish_date_edit"},price:{edit:"price_edit"},rating:{edit:"rating_edit"},review_count:{edit:"review_count_edit"},summary:{edit:"summary_edit"}};return t[e]||{}},getFormatter(e){return"create_date"==e||"update_date"==e?this.formatUtcToUserTime:null},formatUtcToUserTime(e){if(e.cellValue){var t=Intl.DateTimeFormat().resolvedOptions().timeZone||this.default_timezone,r=new Date(e.cellValue),n=new Date(r.toLocaleString("en-US",{timeZone:t})),o=n.toLocaleString(void 0,{timeZone:t});return o}},handleColumns(e){let t=[],r=e.data.actions.POST;const n=["id","book_url"];for(const o in r)if(-1==n.indexOf(o)){let e={field:o,title:r[o].label,slots:this.getCellRender(o),formatter:this.getFormatter(o),sortable:!0};"create_date"!=o&&"update_date"!=o&&(e["editRender"]={}),t.push(e)}return t},refreshField(){this.$axios.options("api/douban_books/").then((e=>{let t=this.handleColumns(e);this.gridOptions.columns=[...this.seqColumn,...t,...this.gridOptions.columns]})).catch((e=>{console.error(e)}))},getOrdering(e){if(!e)return;const t=e.map((e=>"desc"===e.order?`-${e.field}`:e.field));return t.join(",")},requestData(e,t){return this.$axios.get("api/douban_books/",{params:{page:e?e.currentPage:this.gridOptions.pagerConfig.defaultPage,size:e?e.pageSize:this.gridOptions.pageSize,ordering:this.getOrdering(t),search:this.formData.searchContent}})},fetchData(e,t){return this.requestData(e,t).then((e=>(this.limitPageSizes(e),e))).catch((e=>(console.error(e),e)))},limitPageSizes(e){let t=this.gridOptions.pagerConfig;return t.maxPageSize=e.data.max_size,t.pageSizes=t.pageSizes.filter((e=>e<=t.maxPageSize)),e},searchEvent1(){const e=this.$refs.xGrid;e.commitProxy("query")},handleEditActive(){this.stopRefreshInterval()},handleEditClose({$grid:e}){this.stopRefreshInterval(),this.startRefreshInterval(e)},editRowEvent(e){const t=this.$refs.xGrid;t.setActiveRow(e)},getFormData(e){let t=new FormData;for(const r in e){let n=e[r];if("cover_path"==r){if(n=this.coverPathImage,!n)continue}else if(null===n)continue;t.append(r,n)}return t},handleSaveError(e){let t=e.response;this.gridOptions.loading=!1,400==t.status?this.handleTipMessage(t.data):(_().modal.message({content:"保存出错，请稍候再试！",status:"error"}),console.error(e))},updateRow(e,t){this.$axios.put("api/douban_books/"+e.id+"/",t,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{_().modal.message({content:"保存成功！",status:"success"}),this.gridOptions.loading=!1,e.cover_path=t.data.cover_path})).catch((e=>{this.handleSaveError(e)}))},createRow(e,t,r){this.$axios.post("api/douban_books/",t,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{_().modal.message({content:"保存成功！",status:"success"}),this.gridOptions.loading=!1,e.cover_path=t.data.cover_path,this.refreshData(r)})).catch((t=>{this.handleSaveError(t),r.remove(e)}))},saveRowEvent(e){const t=this.$refs.xGrid,r=this.getFormData(e);t.clearActived().then((()=>{this.gridOptions.loading=!0,e.id?this.updateRow(e,r):this.createRow(e,r,t)}))},async removeRowEvent(e){const t=this.$refs.xGrid;if(e.id){const r=await _().modal.confirm("您确定要删除该数据?");"confirm"===r&&(t.remove(e),console.log(t),this.gridOptions.loading=!0,this.$axios.delete("api/douban_books/"+e.id+"/").then((()=>{this.gridOptions.loading=!1,this.refreshData(t),_().modal.message({content:"删除成功！",status:"success"})})).catch((e=>{this.gridOptions.loading=!1,_().modal.message({content:"删除出错，请稍候再试！",status:"error"}),console.error(e)})))}else t.remove(e)},getTipMessage(e){let t="保存失败!\r\n";if("string"===typeof e)t=e;else for(const r in e)t+=r+": "+e[r].join(", ")+"\r\n";return t},handleTipMessage(e){if("error"==e.code){const t=this.getTipMessage(e.errors||e.error);_().modal.message({content:t,status:"error"})}else _().modal.message({content:"删除出错，请稍候再试！",status:"error"}),console.error(e)},handleFileChange(e){const t=e.$event.target.files[0];t&&(this.coverPathImage=t)},resetRequestInfo(){this.pageInfo=null},refreshData(e){this.requestData(this.pageInfo,this.sortInfo).then((t=>{e.loadData(t.data.results),e.tablePage.total=t.data.count})).catch((t=>{t.response&&404==t.response.status&&(this.resetRequestInfo(),e.commitProxy("query")),console.error(t)}))},handleSortChange(e){this.sortInfo=e.sortList},handlePageChange(e){this.pageInfo=e},startRefreshInterval(e){this.refreshDataTimer=setInterval((()=>{this.refreshData(e)}),this.refreshIntervalTime)},stopRefreshInterval(){clearInterval(this.refreshDataTimer)},beforeDestroy(){this.stopRefreshInterval()}}},x=b,y=(0,h.Z)(x,g,m,!1,null,"d5bac01a",null),w=y.exports,k={name:"App",components:{HeaderBox:p,TableBox:w}},C=k,O=(0,h.Z)(C,o,i,!1,null,null,null),S=O.exports,P=r(51346);let $;$=r(49166);const D=P.Z.create({baseURL:$.apiBaseUrl,timeout:1e4});D.interceptors.request.use((e=>e),(e=>Promise.reject(e))),D.interceptors.response.use((e=>e),(e=>Promise.reject(e)));var R=D;n.ZP.prototype.$axios=R,n.ZP.config.productionTip=!1,n.ZP.use(_()),n.ZP.use(u()),new n.ZP({render:e=>e(S),axios:R}).$mount("#app")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.m=e,function(){r.amdO={}}(),function(){var e=[];r.O=function(t,n,o,i){if(!n){var a=1/0;for(c=0;c<e.length;c++){n=e[c][0],o=e[c][1],i=e[c][2];for(var s=!0,l=0;l<n.length;l++)(!1&i||a>=i)&&Object.keys(r.O).every((function(e){return r.O[e](n[l])}))?n.splice(l--,1):(s=!1,i<a&&(a=i));if(s){e.splice(c--,1);var u=o();void 0!==u&&(t=u)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,o,i]}}(),function(){r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t}}(),function(){r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){r.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={826:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,i,a=n[0],s=n[1],l=n[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(o in s)r.o(s,o)&&(r.m[o]=s[o]);if(l)var c=l(r)}for(t&&t(n);u<a.length;u++)i=a[u],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(c)},n=self["webpackChunkcrawl_system_frontend"]=self["webpackChunkcrawl_system_frontend"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=r.O(void 0,[998],(function(){return r(62319)}));n=r.O(n)})();
//# sourceMappingURL=index.f6f1d174.js.map